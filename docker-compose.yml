version: '3.9'

services:

  rabbitmq:
    image: rabbitmq:3-management
    container_name: rabbit-academyio
    ports:
      - "5672:5672"
      - "15672:15672"
    environment:
      RABBITMQ_DEFAULT_USER: guest
      RABBITMQ_DEFAULT_PASS: guest
    networks:
      - academyio

  auth-api:
    build:
      context: .
      dockerfile: src/services/AcademyIODevops.Auth.API/Dockerfile
    container_name: auth-api
    ports:
      - "5077:5077"
    environment:
      ASPNETCORE_URLS: http://+:5077
      MessageQueueConnection__MessageBus: "host=rabbitmq:5672;username=guest;password=guest"
    depends_on:
      - rabbitmq
    networks:
      - academyio

  courses-api:
    build:
      context: .
      dockerfile: src/services/AcademyIODevops.Courses.API/Dockerfile
    container_name: courses-api
    ports:
      - "5078:5078"
    environment:
      ASPNETCORE_URLS: http://+:5078
      MessageQueueConnection__MessageBus: "host=rabbitmq:5672;username=guest;password=guest"
    depends_on:
      - rabbitmq
    networks:
      - academyio

  payments-api:
    build:
      context: .
      dockerfile: src/services/AcademyIODevops.Payments.API/Dockerfile
    container_name: payments-api
    ports:
      - "5272:5272"
    environment:
      ASPNETCORE_URLS: http://+:5272
      MessageQueueConnection__MessageBus: "host=rabbitmq:5672;username=guest;password=guest"
    depends_on:
      - rabbitmq
    networks:
      - academyio

  students-api:
    build:
      context: .
      dockerfile: src/services/AcademyIODevops.Students.API/Dockerfile
    container_name: students-api
    ports:
      - "5275:5275"
    environment:
      ASPNETCORE_URLS: http://+:5275
      MessageQueueConnection__MessageBus: "host=rabbitmq:5672;username=guest;password=guest"
    depends_on:
      - rabbitmq
    networks:
      - academyio

  bff:
    build:
      context: .
      dockerfile: src/api-gateways/AcademyIODevops.Bff/Dockerfile
    container_name: bff-api
    ports:
      - "5107:5107"
    environment:
      ASPNETCORE_URLS: http://+:5107
      
      # URLs internas dos microservi√ßos
      AppServicesSettings__CourseUrl: "http://courses-api:5078"
      AppServicesSettings__StudentUrl: "http://students-api:5275"
      AppServicesSettings__PaymentUrl: "http://payments-api:5272"

    depends_on:
      - auth-api
      - courses-api
      - students-api
      - payments-api
      - rabbitmq
    networks:
      - academyio

networks:
  academyio:
    driver: bridge
